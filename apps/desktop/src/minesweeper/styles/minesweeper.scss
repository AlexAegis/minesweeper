@use 'sass:list';

.minesweeper {
	--border-color-light-og: #fff;
	--border-color-dark-og: #888;
	--panel-border-color: #eee;
	--tile-border-color: #a6a6a6;
	--tile-grid-color-triplet: 192, 192, 192;
	--tile-grid-color: rgb(192 192 192);
	--tile-0-color: #a0a0a0;
	--tile-1-color: #00f;
	--tile-2-color: #008100;
	--tile-3-color: #ff1300;
	--tile-4-color: #000083;
	--tile-5-color: #810500;
	--tile-6-color: #2a9494;
	--tile-7-color: #000;
	--tile-8-color: #808080;
	--tile-9-color: #ffd22e;
	--tile-debug-veil: linear-gradient(
		rgb(var(--tile-grid-color-triplet) 0.8),
		rgb(var(--tile-grid-color-triplet) 0.8)
	);
	--asset-smiley-click: url('../../assets/minesweeper/smiley-click-small.png');
	--asset-smiley-lost: url('../../assets/minesweeper/smiley-lost-small.png');
	--asset-smiley-ongoing: url('../../assets/minesweeper/smiley-ongoing-small.png');
	--asset-smiley-won: url('../../assets/minesweeper/smiley-won-small.png');
	--asset-flag: url('../../assets/minesweeper/flag.png');
	--asset-not-mine: url('../../assets/minesweeper/not-mine.png');
	--asset-question-mark: url('../../assets/minesweeper/question-mark.png');
	--asset-mine: url('../../assets/minesweeper/mine.png');
	--asset-checkmark: url('../../assets/minesweeper/checkmark.png');

	@for $i from 1 through 10 {
		--asset-number-#{$i - 1}: url('../../assets/minesweeper/#{$i - 1}.png');
	}

	// These dimensions were taken from the Windows XP SP3 version of Minesweeper
	--game-area-border-width: 3px; // The outermost border, there is no right and bottom border
	--game-area-padding: 6px; // the game area holds both the 7 segment displays and the tile grid
	// Smiley total size: 28px
	--smiley-icon-size: 17px;
	--smiley-outline-width: 1px;
	--smiley-border-width: 3px;
	--smiley-top-left-padding: 2px;
	--smiley-bottom-right-padding: 1px;

	button.ms-tile {
		height: 16px;
		width: 16px;
		margin: 0;
		border: 0;
		border-bottom: 0;
		border-right: 0;
		display: block;
		box-sizing: border-box;
		padding: 0;
		image-rendering: pixelated;
		background-repeat: no-repeat;
		background-position: 2px 2px;
		user-select: none;
		background-size: auto;
		background-position-x: 3px;
		background-position-y: 3px;

		&.pressed,
		&.revealed {
			box-shadow: none; // inset -1px -1px var(--win-3d-objects-color-darker-1) !important;
			border-color: var(--win-3d-objects-color-darker-1);
			border-width: 1px;
			border-left-style: solid;
			border-top-style: solid;
		}

		&:not(.pressed, .revealed) {
			border: 0;
			box-shadow:
				inset -1px -1px var(--win-3d-objects-color-darker-1),
				inset 1px 1px var(--win-3d-objects-color-lighter-1),
				inset -2px -2px var(--win-3d-objects-color-darker-1),
				inset 2px 2px var(--win-3d-objects-color-lighter-1);
		}

		&:active {
			padding: 0;
		}

		&.wrong:not(.flag) {
			background-color: red;
		}

		&.flag {
			&.revealed,
			&:not(.debug, .wrong) {
				background-image: var(--asset-flag);
			}

			&.debug:not(.revealed, .wrong) {
				background-image: var(--tile-debug-veil), var(--asset-flag);
			}

			&.wrong {
				&.revealed,
				&:not(.debug) {
					background-position: 1px 1px;
					background-image: var(--asset-not-mine);
				}

				&.debug:not(.revealed) {
					background-position: 1px 1px;
					background-image: var(--tile-debug-veil), var(--asset-not-mine);
				}
			}
		}

		&.question-mark {
			&.revealed,
			&:not(.debug) {
				background-image: var(--asset-question-mark);
			}

			&.debug:not(.revealed) {
				background-image: var(--tile-debug-veil), var(--asset-question-mark);
			}
		}

		&.mine {
			&.revealed,
			&:not(.debug) {
				background-image: var(--asset-mine);
			}

			&.debug:not(.revealed) {
				background-image: var(--tile-debug-veil), var(--asset-mine);
			}

			&.pressed {
				background-position: 1px 1px !important;
				background-size: 13px;
			}

			&:not(.pressed) {
				background-position: 0 0 !important;
				background-size: 12px;
			}
		}

		$tile-colors: var(--tile-0-color), var(--tile-1-color), var(--tile-2-color),
			var(--tile-3-color), var(--tile-4-color), var(--tile-5-color), var(--tile-6-color),
			var(--tile-7-color), var(--tile-8-color), var(--tile-9-color);

		@for $i from 2 through 10 {
			&-#{$i - 1} {
				color: list.nth($tile-colors, $i);

				&.revealed,
				&:not(.debug) {
					/* stylelint-disable-next-line custom-property-pattern */
					background-image: var(--asset-number-#{$i - 1});
				}

				&.debug:not(.revealed) {
					/* stylelint-disable-next-line custom-property-pattern */
					background-image: var(--tile-debug-veil), var(--asset-number-#{$i - 1});
				}
			}
		}
	}
}
